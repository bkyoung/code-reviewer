# Code Reviewer Configuration File
# This file configures the code-reviewer application for CI/CD usage

# LLM Provider Configuration
providers:
  # Static provider (for testing - returns canned responses)
  static:
    enabled: false
    model: "static-model"

  # OpenAI provider (GPT models)
  # Note: gpt-5.2-codex not yet available in API (Dec 2025)
  openai:
    enabled: false
    model: "gpt-5.2"
    apiKey: "${OPENAI_API_KEY}"

  # Anthropic provider (Claude models)
  anthropic:
    enabled: true
    model: "claude-sonnet-4-5-20250929"
    apiKey: "${ANTHROPIC_API_KEY}"

  # Google Gemini provider
  gemini:
    enabled: false
    model: "gemini-3-pro-preview"
    apiKey: "${GEMINI_API_KEY}"

  # Ollama provider (local LLM)
  # ollama:
  #   enabled: false
  #   model: "qwen3:235b"

# Store Configuration
# Enables persistence of review history to SQLite database
store:
  enabled: true
  path: "~/.config/cr/reviews.db"

# Output Configuration
output:
  directory: "./review-output"

# Git Configuration (optional)
# git:
#   repositoryDir: "."

# Planning Configuration (disabled for CI/CD - not interactive)
planning:
  enabled: false
  provider: "openai"
  model: "gpt-4o-mini"
  maxQuestions: 5
  timeout: "30s"

# Merge Configuration (for multi-provider consensus)
# merge:
#   enabled: true
#   strategy: "weighted"

# Budget Configuration (cost control)
# budget:
#   hardCapUSD: 10.0
#   degradationPolicy:
#     - "reduce-providers"
#     - "reduce-context"

# Redaction Configuration (secret protection)
# IMPORTANT: Enable this for production use!
redaction:
  enabled: true
  denyGlobs:
    - "**/*.env"
    - "**/*.pem"
    - "**/*.key"
    - "**/credentials.json"
    - "**/secrets.*"

# Determinism Configuration (reproducible reviews)
determinism:
  enabled: false
  temperature: 0.0
  useSeed: true

# Observability Configuration
observability:
  logging:
    enabled: true
    level: "info"
    format: "human"
    redactAPIKeys: true
  metrics:
    enabled: true

# Review Configuration
# Custom instructions to guide the code review process
review:
  instructions: |
    You are an expert code reviewer. Perform a thorough, systematic review of the provided code changes.

    ## Review Categories

    ### 1. Security Analysis (CRITICAL)
    - Identify injection vulnerabilities (SQL, command, XSS, etc.)
    - Check for authentication/authorization issues
    - Look for sensitive data exposure (secrets, PII, API keys in code)
    - Verify proper input validation and sanitization
    - Check for insecure cryptographic practices
    - Identify OWASP Top 10 vulnerabilities

    ### 2. Bug Detection
    - **Obvious bugs**: Null dereferences, off-by-one errors, logic errors
    - **Non-obvious bugs**: Race conditions, resource leaks, deadlocks
    - **Edge cases**: Empty inputs, boundary conditions, error paths
    - **Concurrency issues**: Data races, improper synchronization, goroutine leaks
    - **Resource management**: Unclosed resources, memory leaks, connection pooling issues

    ### 3. Test Coverage Assessment
    - Are there sufficient unit tests for new functionality?
    - Do tests cover edge cases and error paths?
    - Is there integration test coverage where appropriate?
    - Are test assertions meaningful (not just checking for nil)?
    - Would additional test cases improve confidence in the code?

    ### 4. Code Quality & Maintainability
    - **DRY violations**: Duplicated code that should be extracted
    - **Code reuse**: Opportunities to leverage existing utilities or abstractions
    - **Refactoring opportunities**: Complex functions that should be decomposed
    - **Naming**: Are variables, functions, and types clearly named?
    - **Documentation**: Are complex algorithms or non-obvious decisions documented?
    - **Error handling**: Are errors handled appropriately and not silently swallowed?

    ### 5. Design & Architecture
    - Does the code follow SOLID principles?
    - Is the abstraction level appropriate?
    - Are dependencies properly managed and injected?
    - Does the change fit the existing architecture patterns?
    - Could the design be simplified without losing functionality?

    ### 6. Fitness for Purpose
    - Does this code solve the problem it's meant to solve?
    - Are there gaps between the implementation and stated requirements?
    - Are there unhandled scenarios or use cases?
    - Is the solution complete or does it leave technical debt?

    ### 7. Performance Considerations
    - Are there obvious performance issues (N+1 queries, unnecessary allocations)?
    - Is the algorithmic complexity appropriate?
    - Are there opportunities for caching or memoization?

    ## Reporting Guidelines

    - Prioritize findings by severity: CRITICAL > HIGH > MEDIUM > LOW
    - For each finding, explain WHY it's a problem and HOW to fix it
    - Be specific with file paths and line numbers
    - Distinguish between blocking issues and suggestions
    - If code is well-written, acknowledge what's done well
    - Focus on actionable feedback, not stylistic preferences unless they impact clarity

# HTTP Configuration
http:
  timeout: "120s"
  maxRetries: 5
  initialBackoff: "2s"
  maxBackoff: "30s"
  backoffMultiplier: 2.0
