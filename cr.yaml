# Code Reviewer Configuration File
# This file configures the code-reviewer application for CI/CD usage

# LLM Provider Configuration
providers:
  # Static provider (for testing - returns canned responses)
  static:
    enabled: false
    model: "static-model"

  # OpenAI provider (GPT models)
  openai:
    enabled: true
    model: "gpt-5.2"
    apiKey: "${OPENAI_API_KEY}"

  # Anthropic provider (Claude models)
  anthropic:
    enabled: true
    model: "claude-sonnet-4-5-20250929"
    apiKey: "${ANTHROPIC_API_KEY}"

  # Google Gemini provider
  gemini:
    enabled: true
    model: "gemini-3-pro-preview"
    apiKey: "${GEMINI_API_KEY}"

  # Ollama provider (local LLM)
  # ollama:
  #   enabled: false
  #   model: "qwen3:235b"

# Store Configuration
# Enables persistence of review history to SQLite database
store:
  enabled: true
  path: "~/.config/cr/reviews.db"

# Output Configuration
output:
  directory: "./review-output"

# Git Configuration (optional)
# git:
#   repositoryDir: "."

# Planning Configuration (disabled for CI/CD - not interactive)
planning:
  enabled: false
  provider: "openai"
  model: "gpt-4o-mini"
  maxQuestions: 5
  timeout: "30s"

# Merge Configuration (for multi-provider consensus)
# merge:
#   enabled: true
#   strategy: "weighted"

# Budget Configuration (cost control)
# budget:
#   hardCapUSD: 10.0
#   degradationPolicy:
#     - "reduce-providers"
#     - "reduce-context"

# Redaction Configuration (secret protection)
# IMPORTANT: Enable this for production use!
redaction:
  enabled: true
  denyGlobs:
    - "**/*.env"
    - "**/*.pem"
    - "**/*.key"
    - "**/credentials.json"
    - "**/secrets.*"

# Determinism Configuration (reproducible reviews)
determinism:
  enabled: false
  temperature: 0.0
  useSeed: true

# Observability Configuration
observability:
  logging:
    enabled: true
    level: "info"
    format: "human"
    redactAPIKeys: true
  metrics:
    enabled: true

# Review Configuration
# Custom instructions to guide the code review process
# NOTE: Output format is handled by the system. These instructions focus on WHAT to review.
review:
  instructions: |
    Perform a thorough, systematic review focusing on these categories:

    **Security (use category: "security", severity: "high" for vulnerabilities):**
    - Injection vulnerabilities (SQL, command, XSS)
    - Authentication/authorization issues
    - Sensitive data exposure (secrets, PII, API keys)
    - Input validation and sanitization
    - OWASP Top 10 vulnerabilities

    **Bugs (use category: "bug"):**
    - Null dereferences, off-by-one errors, logic errors (severity: "high")
    - Race conditions, resource leaks, deadlocks (severity: "high")
    - Edge cases: empty inputs, boundary conditions (severity: "medium")
    - Concurrency issues, goroutine leaks (severity: "high")

    **Test Coverage (use category: "test_coverage", severity: "medium"):**
    - Missing unit tests for new functionality
    - Untested edge cases and error paths
    - Weak assertions that don't verify behavior

    **Code Quality (use category: "maintainability", severity: "low"):**
    - DRY violations and duplicated code
    - Complex functions needing decomposition
    - Poor naming or unclear code
    - Silent error swallowing (use category: "error_handling", severity: "medium")

    **Architecture (use category: "architecture", severity: "medium"):**
    - SOLID principle violations
    - Inappropriate abstraction levels
    - Missing dependency injection

    **Performance (use category: "performance"):**
    - N+1 queries, unnecessary allocations (severity: "medium")
    - Poor algorithmic complexity (severity: "high" if significant)

    Prioritize: security vulnerabilities > bugs > error handling > everything else.
    Only report actionable issues. Skip stylistic preferences unless they impact clarity.

# HTTP Configuration
http:
  timeout: "120s"
  maxRetries: 5
  initialBackoff: "2s"
  maxBackoff: "30s"
  backoffMultiplier: 2.0
